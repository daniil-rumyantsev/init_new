"use strict";function readCookie(){var a=0;getCookie("categories")&&(resultData.category_check=getCookie("categories"),$("#categoryDropdown").addClass("my-btn-filter--highlighted").text(resultData.category_check),$("#categoryDropdown_cross").css("display","inline"),a=1),getCookie("realmodel")&&getCookie("series_check")&&(resultData.series_check=getCookie("series_check"),resultData.realmodel=getCookie("realmodel"),$("#seriesDropdown").addClass("my-btn-filter--highlighted").text(resultData.series_check),$("#seriesDropdown_cross").css("display","inline"),a=1),getCookie("max_area")&&(resultData.max_area=getCookie("max_area"),a=1),getCookie("min_area")&&(resultData.max_area=getCookie("min_area"),a=1),getCookie("floor_check")&&(resultData.floor_check=getCookie("floor_check"),$("#house-floorsDropdown").addClass("my-btn-filter--highlighted").text(resultData.floor_check),$("#house-floorsDropdown_cross").css("display","inline"),a=1),getCookie("tech_check")&&(resultData.tech_check=getCookie("tech_check"),$("#house-techDropdown").addClass("my-btn-filter--highlighted").text(resultData.tech_check),$("#house-techDropdown_cross").css("display","inline"),a=1),getCookie("min_price")&&(resultData.min_price=getCookie("min_price"),a=1),getCookie("max_price")&&(resultData.max_price=getCookie("max_price"),a=1),getCookie("min_width")&&(resultData.min_width=getCookie("min_width"),a=1),getCookie("min_length")&&(resultData.min_length=getCookie("min_length"),a=1),a&&filter()}function filter(){var a=$(".b-chosen-options"),b=$(".b-reset-button"),c=$("#variants-count");""==resultData.category_check&&""==resultData.series_check&&""==resultData.floor_check&&""==resultData.tech_check&&0==resultData.max_area&&0==resultData.min_area&&0==resultData.max_price&&0==resultData.min_price&&0==resultData.min_width&&0==resultData.min_length&&(a.hide(),b.hide());var h=(resultData.category_check,resultData.series_check,resultData.floor_check,resultData.tech_check,$("#valit").val());$.ajax("/include/filter_search.php",{method:"GET",async:!1,data:{categories:resultData.category_check,series:resultData.series_check,realmodel:resultData.realmodel,floors:resultData.floor_check,tehnologies:resultData.tech_check,max_area:resultData.max_area,min_area:resultData.min_area,max_price:resultData.max_price,min_price:resultData.min_price,min_width:resultData.min_width,min_length:resultData.min_length,valid:h},success:function(b){var d=[];d=JSON.parse(b),d.length>0&&renderFilter(d),renderResult(d);var e=renderResult(d).length,f=$(".b-chosen-options");parseInt(e)>0?($(".error-msg").hide(),$(c).html(e+" "+declension(e,[" вариант"," варианта"," вариантов"])),f.show()):$(".error-msg").show()}})}function onlyUnique(a,b,c){return c.indexOf(a)===b}function renderResult(a){var b=[];for(var c in a)b.push(a[c].id_series);var d=b.filter(onlyUnique);return $.ajax("/include/ajax_catalog.php",{method:"GET",async:!1,data:{result_filter:d},success:function(b){$("#ajax-catalog").html(b)}}),d}function renderFilter(a){var b=$(".categories-filter"),c=$(".series-filter"),d=$(".floors-filter"),e=$(".tehnologies-filter"),f=[],g="",h=[],i="",j=[],k="",l=[],m="",n=[],o=[],p=[],q=[];a.filter(function(a){-1==find(f,a.id_category)&&(f.push(a.id_category),g=a.id_category==resultData.category_check?g+'<li  class="category-li-filter active" data-id="'+a.category_name+'"><a href="#" data-name="'+a.category_name+'" >'+a.category_name+"</a></li>":g+'<li  class="category-li-filter" data-id="'+a.category_name+'"><a href="#" data-name="'+a.category_name+'" >'+a.category_name+"</a></li>"),-1===find(h,a.series_name)&&(h.push(a.series_name),i=a.series_name==resultData.series_check?i+'<li data-id="'+a.series_name+'" data-id="'+a.series_name+'" data-key="'+a.id_series+'" class="series-filter-li active" ><a href="#" data-name="'+a.series_name+'" >'+a.series_name+"</a></li>":i+'<li data-id="'+a.series_name+'" data-id="'+a.series_name+'" data-key="'+a.id_series+'" class="series-filter-li" ><a href="#" data-name="'+a.series_name+'" >'+a.series_name+"</a></li>"),-1===find(j,a.floors)&&(j.push(a.floors),k=a.series_name==resultData.floor_check?k+'<li data-id="'+a.floors+'" class="floor-dilter-li active"><a href="#" data-name="'+a.floors+'" >'+a.floors+declension(a.floors,[" этаж"," этажа"," этажей"])+" </a></li>":k+'<li data-id="'+a.floors+'" class="floor-dilter-li"><a href="#" data-name="'+a.floors+'" >'+a.floors+declension(a.floors,[" этаж"," этажа"," этажей"])+" </a></li>"),-1===find(l,a.technology)&&(l.push(a.technology),m=a.technology==resultData.tech_check?m+'<li class="filter-tech-li active" data-id="'+a.technology+'"><a href="#" data-name="'+a.technology+'" >'+a.technology+"</a></li>":m+'<li class="filter-tech-li" data-id="'+a.technology+'"><a href="#" data-name="'+a.technology+'" >'+a.technology+"</a></li>"),-1===find(n,parseInt(a.total_area))&&n.push(parseInt(a.total_area)),-1===find(o,parseInt(a.price_value))&&o.push(parseInt(a.price_value)),-1===find(p,parseInt(a.length))&&p.push(parseInt(a.length)),-1===find(q,parseInt(a.width))&&q.push(parseInt(a.width))});var r=Math.min.apply(null,n),s=Math.max.apply(null,n);$("#house-area-from").attr("data-val",parseInt(r)),$("#house-area-from").attr("placeholder","от "+r),$("#house-area-up-to").attr("data-val",parseInt(s)),$("#house-area-up-to").attr("placeholder","до "+s);var t=Math.min.apply(null,o),u=Math.max.apply(null,o);$("#house-price-from").attr("data-val",t),$("#house-price-from").attr("placeholder","от "+t),$("#house-price-up-to").attr("data-val",u),$("#house-price-up-to").attr("placeholder","до "+u);var v=Math.max.apply(null,p),w=Math.max.apply(null,q);$("#house-width-from").attr("data-val",v),$("#house-width-from").attr("placeholder","до "+v),$("#house-length-from").attr("data-val",w),$("#house-length-from").attr("placeholder","до "+w),f.length>0&&b.html(g),h.length>0&&c.html(i),j.length>0&&d.html(k),l.length>0&&e.html(m)}function find(a,b){for(var c=0;c<a.length;c++)if(a[c]==b)return c;return-1}function declension(a,b){var c,d=a%100;return d>=5&&d<=20?c=b[2]:(d%=10,c=1==d?b[0]:d>=2&&d<=4?b[1]:b[2]),c}function setCookie(a,b,c){c=c||{};var d=c.expires;if("number"==typeof d&&d){var e=new Date;e.setTime(e.getTime()+1e3*d),d=c.expires=e}d&&d.toUTCString&&(c.expires=d.toUTCString()),b=encodeURIComponent(b);var f=a+"="+b;for(var g in c){f+="; "+g;var h=c[g];!0!==h&&(f+="="+h)}document.cookie=f}function getCookie(a){var b=document.cookie.match(new RegExp("(?:^|; )"+a.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return b?decodeURIComponent(b[1]):void 0}function deleteCookie(a){setCookie(a,"",{expires:-1})}var resultData={category_check:"",series_check:"",realmodel:"",floor_check:"",tech_check:"",max_area:0,min_area:0,max_price:0,min_price:0,min_width:0,min_length:0,ajax:"",input:0,inputID:""};$(document).ready(function(){function f(a){var e=$(a),g=($(e).text(),$(e).attr("id").split("-")),j=$(e).val();$(e).attr("data-val",parseInt(j));var k=$(a).closest(".dropdown").find(".my-btn-filter"),l=$(k).attr("id"),m=parseInt($(e).val()),n=$(a).attr("name"),o=$(".b-chosen-options"),p=$(".b-reset-button");if("house-areaFrom"==n||"house-areaUpto"==n){if(parseInt(j)){"from"==g[2]?d.textFrom=h("from",m):d.textTo=h("up",m);var q="";"от"!=d.textFrom&&(q+=d.textFrom),"до"!=d.textTo&&(q+=d.textTo),!isNaN(d.from)&&d.from&&(d.textAll+=" "+d.textTo+" "+d.textFrom)}}else if("house-widthFrom"==n||"house-lengthFrom"==n){if(parseInt(j)){"house-widthFrom"==n?c.textFrom=i("from",m):c.textTo=i("up",m);var r="";""!=c.textFrom&&(r+=c.textFrom),"x"!=c.textTo&&(r+=c.textTo),!isNaN(c.from)&&c.from&&(c.textAll+=" "+c.textTo+" "+c.textFrom),$("#"+l+"_cross").show(),$("#"+l+"_span").show()}}else if(parseInt(j)){"from"==g[2]?b.textFrom=h("from",m):b.textTo=h("up",m);var s="";"от"!=b.textFrom&&(s+=b.textFrom),"до"!=b.textTo&&(s+=b.textTo),!isNaN(b.from)&&b.from&&(b.textAll+=" "+b.textTo+" "+b.textFrom),$("#"+l+"_cross").show(),$("#"+l+"_span").show()}var t=parseInt($("#house-price-from").val()),u=parseInt($("#house-width-from").val()),v=parseInt($("#house-length-from").val()),w=parseInt($("#house-price-up-to").val()),x=parseInt($("#house-area-from").val()),y=parseInt($("#house-area-up-to").val()),z=$("#house-priceDropdown"),A=$("#house-areaDropdown"),B=$("#house-sizeDropdown");if(isNaN(u)&&isNaN(v))"house-sizeDropdown_span"==$("#"+l+"_span").attr("id")&&$("#"+l+"_span").hide(),$("#house-sizeDropdown").html('Размер<span class="my-caret"></span>'),$("#house-sizeDropdown").removeClass("my-btn-filter--highlighted"),$(k).siblings(".my-cross").hide(),z.html(z.data("placeholder")+' <span class="my-caret"></span>'),resultData.min_width=0,resultData.min_length=0,deleteCookie("min_width"),deleteCookie("min_length");else{if(isNaN(u))resultData.min_width=0,deleteCookie("min_width");else{B.html(r).addClass("my-btn-filter--highlighted"),$("#"+l+"_cross").show(),$("#"+l+"_span").show();var C=u;resultData.min_width=C,setCookie("min_width",C)}if(isNaN(v))resultData.min_length=0,deleteCookie("min_length");else{B.html(r).addClass("my-btn-filter--highlighted"),$("#"+l+"_cross").show(),$("#"+l+"_span").show();var D=parseInt($("#house-length-from").attr("data-val"));resultData.min_length=D,setCookie("min_length",D)}}if(isNaN(t)&&isNaN(w))"house-priceDropdown_span"==$("#"+l+"_span").attr("id")&&$("#"+l+"_span").hide(),$(k).siblings(".my-cross").hide(),z.html(z.data("placeholder")+' <span class="my-caret"></span>'),resultData.max_price=0,resultData.min_price=0,deleteCookie("min_price"),deleteCookie("max_price");else{if(isNaN(t))resultData.min_price=0,deleteCookie("min_price");else{z.html(s).addClass("my-btn-filter--highlighted"),$("#"+l+"_cross").show(),$("#"+l+"_span").show();var E=parseInt($("#house-price-from").attr("data-val"));resultData.min_price=E,setCookie("min_price",E)}if(isNaN(w))resultData.max_price=0,deleteCookie("max_price");else{z.html(s).addClass("my-btn-filter--highlighted"),$("#"+l+"_cross").show(),$("#"+l+"_span").show();var F=parseInt($("#house-price-up-to").attr("data-val"));resultData.max_price=F,setCookie("min_price",F)}}if(isNaN(x)&&isNaN(y))"house-areaDropdown_span"==$("#"+l+"_span").attr("id")&&$("#"+l+"_span").hide(),$(k).siblings(".my-cross").hide(),A.html(A.data("placeholder")+' <span class="my-caret"></span>'),resultData.min_area=0,resultData.max_area=0,deleteCookie("max_area"),deleteCookie("min_area");else{if(isNaN(x))resultData.min_area=0,deleteCookie("min_area");else{A.html(q).addClass("my-btn-filter--highlighted"),$("#"+l+"_cross").show(),$("#"+l+"_span").show();var G=parseInt($("#house-area-from").attr("data-val"));resultData.min_area=G,setCookie("min_area",G)}if(isNaN(y))resultData.max_area=0,deleteCookie("max_area");else{A.html(q).addClass("my-btn-filter--highlighted"),$("#"+l+"_cross").show(),$("#"+l+"_span").show();var H=parseInt($("#house-area-up-to").attr("data-val"));resultData.max_area=H,setCookie("max_area",H)}}"house-priceDropdown"==l&&$("#"+l+"_span").html("\n                            "+s+' тыс.р. <span class="my-cross my-cross--b-chosen-option '+l+'" data-parent="'+l+'"></span>\n\n                        '),"house-areaDropdown"==l&&$("#"+l+"_span").html("\n                            "+q+' кв.м <span class="my-cross my-cross--b-chosen-option '+l+'" data-parent="'+l+'"></span>\n\n                        '),"house-sizeDropdown"==l&&$("#"+l+"_span").html("\n                            "+r+' м <span class="my-cross my-cross--b-chosen-option '+l+'" data-parent="'+l+'"></span>\n\n                        '),o.show(),p.show(),filter()}function g(){var a=$("#categoryDropdown").data("placeholder");"Категория дома"!=a&&(resultData.category_check=a)}function h(a,b){var c=!1;if("from"==a)var d="от";if("up"==a)var d=" до";return!isNaN(b)&&b&&0!=b?(c=d,c+=" "+b):c="",c}function i(a,b){var c=!1;if("from"==a)var d="";if("up"==a)var d=" x";return!isNaN(b)&&b&&0!=b?(c=d,c+=" "+b):c="",c}$(".price-link-page").on("click",function(){switch(deleteCookie("VARIANT_HOUSE"),$(this).data("tech")){case"Каркас":setCookie("VARIANT_HOUSE","KARKAS",{path:"/"});break;case"Брус":setCookie("VARIANT_HOUSE","BRUS",{path:"/"});break;case"Кирпич":setCookie("VARIANT_HOUSE","KIRPICH",{path:"/"});break;default:setCookie("VARIANT_HOUSE","KARKAS",{path:"/"})}var b=$(this).attr("href");return location.href=b,!1});var a=!1;readCookie(),$(".house__filter").on("click",".dropdown",function(a){var b=$(this).children(".my-btn-filter"),c=$(b).attr("id");"true"==$(b).data("checked")&&$("#"+c+"_cross").show()}),$("#filter_refresh").on("click",function(){return deleteCookie("categories"),deleteCookie("tech_check"),deleteCookie("realmodel"),deleteCookie("series_check"),deleteCookie("floor_check"),deleteCookie("min_price"),deleteCookie("min_width"),deleteCookie("min_length"),deleteCookie("max_price"),deleteCookie("max_area"),deleteCookie("min_area"),deleteCookie("VARIANT_HOUSE"),location.reload(),!1}),$(".house__filter").on("click",".my-cross",function(){var a=$(this).data("parent"),e=$("#"+a).data("placeholder");$(".b-chosen-options");console.log(a),$("#"+a).data("checked",!1),$("#"+a+"_cross").hide(),$("#"+a+"_span").hide(),$("#"+a).html(e+'<span class="my-caret"></span>').removeClass("my-btn-filter--highlighted"),g(),"categoryDropdown"==a&&($("#category").val(""),resultData.category_check="",deleteCookie("categories"),filter()),"seriesDropdown"==a&&($("#modalinpt").val(""),resultData.series_check="",deleteCookie("realmodel"),deleteCookie("series_check"),filter()),"house-floorsDropdown"==a&&($("#floors").val(""),resultData.floor_check="",deleteCookie("floor_check"),filter()),"house-techDropdown"==a&&($("#tech").val(""),resultData.tech_check="",deleteCookie("tech_check"),deleteCookie("VARIANT_HOUSE"),filter()),"house-priceDropdown"==a&&($("#house-price-from").val(""),$("#house-price-up-to").val(""),resultData.min_price=0,resultData.max_price=0,deleteCookie("min_price"),deleteCookie("max_price"),b.textFrom="",b.textTo="",filter()),"house-sizeDropdown"==a&&($("#house-width-from").val(""),$("#house-length-from").val(""),resultData.min_width=0,resultData.min_length=0,deleteCookie("min_width"),deleteCookie("min_length"),c.textFrom="",c.textTo="",filter()),"house-areaDropdown"==a&&($("#house-area-from").val(""),$("#house-area-up-to").val(""),resultData.min_area=0,resultData.max_area=0,deleteCookie("max_area"),deleteCookie("min_area"),d.textFrom="",d.textTo="",filter())}),$(".house__filter").on("click","li",function(b){b.preventDefault();var c=b.target||window.target,d=$(c).parent(),e=$(c).html(),f=$(this).parent().prev(),g=$(f).attr("id"),h=$(".b-chosen-options"),i=$(".b-reset-button");$("#variants-count");if(d.addClass("active"),d.siblings().removeClass("active"),f.html(e).addClass("my-btn-filter--highlighted").siblings("#"+g).val(e),$(f).data("checked","true"),0==a&&($(".hint-bubble").show(),a=!0),$(this).hasClass("series-filter-li")){var k=$(this).data("key"),e=$(this).data("id");$("#realmodel").val(k),$("#modalinpt").val(e),resultData.series_check=e,resultData.realmodel=k,setCookie("realmodel",k),setCookie("series_check",e)}if($(this).hasClass("category-li-filter")){var e=$(this).data("id");$("#category").attr("val",e),$("#category").val(e),setCookie("categories",e),resultData.category_check=e}if($(this).hasClass("floor-dilter-li")){var e=$(this).data("id");$("#floors").val(e),resultData.floor_check=e,setCookie("floor_check",e)}if($(this).hasClass("filter-tech-li")){var e=$(this).data("id");$("#tech").val(e),resultData.tech_check=e,setCookie("tech_check",e),"Каркасный 150"!=e&&"Каркасный 100"!=e&&"Каркасный 200"!=e||setCookie("VARIANT_HOUSE","KARKAS",{path:"/"}),"Брус клееный 150"!=e&&"Брус клееный 180"!=e&&"Брус клееный 180 МБ"!=e||setCookie("VARIANT_HOUSE","BRUS",{path:"/"}),"Кирпичный"==e&&setCookie("VARIANT_HOUSE","KIRPICH",{path:"/"})}else;"house-floorsDropdown"==g?$("#"+g+"_span").html("\n                            "+e+" "+declension(e,[" этаж"," этажа"," этажей"])+' <span class="my-cross my-cross--b-chosen-option" data-parent="'+g+'"></span>,\n\n                        '):$("#"+g+"_span").html("\n                            "+e+' <span class="my-cross my-cross--b-chosen-option" data-parent="'+g+'"></span>,\n\n                        '),$("#"+g+"_span").show(),h.show(),i.show(),filter()});var b={textFrom:"от",textTo:"до",text:""},c={textFrom:"",textTo:"x",text:""},d={textFrom:"от",textTo:"до",text:""},e="";$(".dropdown-toggle").on(function(a){e="";var b=a.target||window.target;e=$(b).text()}),$(".range-box input").click(function(a){a.stopPropagation()}),$(".range-box").on("click",".enter-icon",function(a){var b=this;f($(b).prev("input"))}),$(".range-box").on("keyup","input",function(a){var b=this,c=$(b).val(),d=$(b).attr("id");13==a.keyCode&&(resultData.input!=c&&resultData.inputID==d?(resultData.input=$(b).val(),resultData.inputID=$(b).attr("id"),f(b)):resultData.inputID!=d&&(resultData.input=$(b).val(),resultData.inputID=$(b).attr("id"),f(b))),8!=a.keyCode&&46!=a.keyCode||(resultData.input=0,resultData.inputID="")})});